<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://nathaniel.varona.me/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/" /><meta property="og:url" content="https://nathaniel.varona.me/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/" /><meta property="og:site_name" content="Nathaniel Varona" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-03T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions" /><meta name="twitter:site" content="@nathanielvarona" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-08-28T12:32:23+08:00","datePublished":"2023-03-03T00:00:00+08:00","description":"Introduction","headline":"Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions","mainEntityOfPage":{"@type":"WebPage","@id":"https://nathaniel.varona.me/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/"},"url":"https://nathaniel.varona.me/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/"}</script><title>Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions | Nathaniel Varona</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-7S51SBJX8F"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-7S51SBJX8F'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/favicons/android-chrome-512x512.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Nathaniel Varona</a><p class="site-subtitle fst-italic mb-0">I am a DevOps and SRE focussing on Cloud Computing and Distributed Systems.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/nathanielvarona" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/nathanielvarona" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-x-twitter"></i> </a> <a href="https://www.linkedin.com/in/nathanielvarona" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1677772800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 3, 2023 </time> </span> <span> Updated <time data-ts="1724819543" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 28, 2024 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/nathanielvarona">Nathaniel Varona</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2253 words" > <em>12 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Maintaining accounts with Terraform ensures a single source of truth about what changes we made for our principals and recommended policies based on organization guidelines. We can also structure and manage the changes for our IAM Identity Center Multi-account Permission declaratively with the help of Hashicorp Configuration Language (HCL). Either a long-time or newly hired operations engineer can change quickly.</p><h2 id="quick-demo"><span class="me-2">Quick Demo</span><a href="#quick-demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/multi-account-terraform-quick-action-demo-dark.gif" class="popup img-link dark shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/multi-account-terraform-quick-action-demo-dark.gif" alt="AWS Console Access Portal" class="shadow" loading="lazy"></a> <a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/multi-account-terraform-quick-action-demo-light.gif" class="popup img-link light shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/multi-account-terraform-quick-action-demo-light.gif" alt="AWS Console Access Portal" class="shadow" loading="lazy"></a></p><blockquote><p><em>Recorded with <a href="https://asciinema.org/a/586478/?autoplay=1&amp;preload=1&amp;loop=1&amp;theme=asciinema" target="_blank" class="dark">asciinema</a> <a href="https://asciinema.org/a/586478/?autoplay=1&amp;preload=1&amp;loop=1&amp;theme=solarized-light" target="_blank" class="light">asciinema</a></em></p></blockquote><h2 id="requirements"><span class="me-2">Requirements</span><a href="#requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="aws-organization"><span class="me-2">AWS Organization</span><a href="#aws-organization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ensure we have at least two <a href="https://console.aws.amazon.com/organizations/v2/home/accounts">AWS Organization Accounts</a> in a different environment.</p><div class="table-wrapper"><table><thead><tr><th>AWS Organization Account<th>Description<tbody><tr><td>Operations Management<td>Our main AWS Account where we manage our AWS Organization Accounts.<tr><td>Development<td>The Account for Development, QA, and Testing.<tr><td>Production<td>The Account for Production Workloads.</table></div><h3 id="iam-identity-center-users"><span class="me-2">IAM Identity Center Users</span><a href="#iam-identity-center-users" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="table-wrapper"><table><thead><tr><th>Display Name<th>User Name<th>Group Name<tbody><tr><td>John Doe<td>johndoe@domain.tld<td>administrator<tr><td>Sarah Jane<td>sarahjane@domain.tld<td>operations<tr><td>Marcello Kelley<td>marcellokelley@domain.tld<td>developer<tr><td>Miliana Smith<td>milianasmith@domain.tld<td>developer<tr><td>Antonia Morris<td>antoniamorris@domain.tld<td><code class="language-plaintext highlighter-rouge">&lt;NO GROUP&gt;</code></table></div><blockquote class="prompt-tip"><p>A user with <code class="language-plaintext highlighter-rouge">&lt;NO GROUP&gt;</code> could be independently set or under other groups, such as <code class="language-plaintext highlighter-rouge">qualityassurance</code>, or a combination of any existing groups in our user’s table.</p></blockquote><h3 id="download-and-install-tooling-softwares"><span class="me-2">Download and Install Tooling Softwares</span><a href="#download-and-install-tooling-softwares" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Instead of using Vanilla Terraform, we will use a Terraform Framework called Terraspace. Terraspace helps us organize the resources by stacks, keeping them organized and manageable at the same time.</p><ol><li><a href="https://developer.hashicorp.com/terraform/downloads" target="_blank">Terraform</a><li><a href="https://terraspace.cloud/docs/install/" target="_blank">Terraspace</a><li><a href="https://git-scm.com/downloads" target="_blank">Git</a></ol><h2 id="aws-iam-account"><span class="me-2">AWS IAM Account</span><a href="#aws-iam-account" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Create an AWS IAM Account with Programmatic Access having the following managed permissions policies attached.</p><ol><li><code class="language-plaintext highlighter-rouge">AmazonS3FullAccess</code> - Provides full access to all buckets.<li><code class="language-plaintext highlighter-rouge">AmazonDynamoDBFullAccess</code> - Provides full access to Amazon DynamoDB.<li><code class="language-plaintext highlighter-rouge">IAMFullAccess</code> - Provides full access to IAM.<li><code class="language-plaintext highlighter-rouge">AWSSSOMasterAccountAdministrator</code> - Provides access within AWS SSO to manage AWS Organizations master and member accounts and cloud application.</ol><h4 id="create-an-aws-iam-for-our-terraform"><span class="me-2">Create an AWS IAM for our Terraform</span><a href="#create-an-aws-iam-for-our-terraform" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="Create IAM User Programmatic Access"><div class="code-header"> <span data-label-text="Create IAM User Programmatic Access"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre>aws iam create-user <span class="nt">--user-name</span> provisioner
<span class="c"># {</span>
<span class="c">#   "User": {</span>
<span class="c">#     "Path": "/",</span>
<span class="c">#     "UserName": "provisioner",</span>
<span class="c">#     "UserId": "XXXXXXXXXXXXXXXXXXXX",</span>
<span class="c">#     "Arn": "arn:aws:iam::&lt; AWS ACCOUNT ID &gt;:user/provisioner",</span>
<span class="c">#     "CreateDate": "2023-02-23T11:25:55+00:00"</span>
<span class="c">#   }</span>
<span class="c"># }</span>

aws iam create-access-key <span class="nt">--user-name</span> provisioner
<span class="c"># {</span>
<span class="c">#   "AccessKey": {</span>
<span class="c">#     "UserName": "provisioner",</span>
<span class="c">#     "AccessKeyId": "&lt; AWS_ACCESS_KEY_ID &gt;",</span>
<span class="c">#     "Status": "Active",</span>
<span class="c">#     "SecretAccessKey": "&lt; AWS_SECRET_ACCESS_KEY &gt;",</span>
<span class="c">#     "CreateDate": "2023-02-23T11:31:51+00:00"</span>
<span class="c">#   }</span>
<span class="c"># }</span>

aws iam attach-user-policy <span class="nt">--user-name</span> provisioner <span class="se">\</span>
  <span class="nt">--policy-arn</span> arn:aws:iam::aws:policy/AmazonS3FullAccess

aws iam attach-user-policy <span class="nt">--user-name</span> provisioner <span class="se">\</span>
  <span class="nt">--policy-arn</span> arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess

aws iam attach-user-policy <span class="nt">--user-name</span> provisioner <span class="se">\</span>
  <span class="nt">--policy-arn</span> arn:aws:iam::aws:policy/AWSSSODirectoryAdministrator

aws iam attach-user-policy <span class="nt">--user-name</span> provisioner <span class="se">\</span>
  <span class="nt">--policy-arn</span> arn:aws:iam::aws:policy/IAMFullAccess

aws iam list-attached-user-policies <span class="nt">--user-name</span> provisioner
<span class="c"># {</span>
<span class="c">#   "AttachedPolicies": [</span>
<span class="c">#     {</span>
<span class="c">#         "PolicyName": "IAMFullAccess",</span>
<span class="c">#         "PolicyArn": "arn:aws:iam::aws:policy/IAMFullAccess"</span>
<span class="c">#     },</span>
<span class="c">#     {</span>
<span class="c">#         "PolicyName": "AWSSSOMasterAccountAdministrator",</span>
<span class="c">#         "PolicyArn": "arn:aws:iam::aws:policy/AWSSSOMasterAccountAdministrator"</span>
<span class="c">#     },</span>
<span class="c">#     {</span>
<span class="c">#         "PolicyName": "AmazonDynamoDBFullAccess",</span>
<span class="c">#         "PolicyArn": "arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess"</span>
<span class="c">#     },</span>
<span class="c">#     {</span>
<span class="c">#         "PolicyName": "AmazonS3FullAccess",</span>
<span class="c">#         "PolicyArn": "arn:aws:iam::aws:policy/AmazonS3FullAccess"</span>
<span class="c">#     }</span>
<span class="c">#   ]</span>
<span class="c"># }</span>
</pre></table></code></div></div><h4 id="load-the-aws-iam-credentials-to-our-system-profile"><span class="me-2">Load the AWS IAM Credentials to our System Profile</span><a href="#load-the-aws-iam-credentials-to-our-system-profile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="Load and Test Credentials"><div class="code-header"> <span data-label-text="Load and Test Credentials"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>aws configure <span class="nt">--profile</span> provisioner
<span class="c"># AWS Access Key ID [None]: &lt; AWS_ACCESS_KEY_ID &gt;</span>
<span class="c"># AWS Secret Access Key [None]: &lt; AWS_SECRET_ACCESS_KEY &gt;</span>
<span class="c"># Default region name [None]: us-east-1</span>
<span class="c"># Default output format [None]: json</span>

<span class="nb">export </span><span class="nv">AWS_PROFILE</span><span class="o">=</span>provisioner

aws sts get-caller-identity
<span class="c"># {</span>
<span class="c">#   "UserId": "XXXXXXXXXXXXXXXXXXXX",</span>
<span class="c">#   "Account": "&lt; AWS ACCOUNT ID &gt;",</span>
<span class="c">#   "Arn": "arn:aws:iam::&lt; AWS ACCOUNT ID &gt;:user/provisioner"</span>
<span class="c"># }</span>
</pre></table></code></div></div><blockquote class="prompt-info"><p>Our AWS IAM User for Terraform <code class="language-plaintext highlighter-rouge">provisioner</code> is now ready to use.</p></blockquote><h2 id="multi-account-permissions-project"><span class="me-2">Multi-Account Permissions Project</span><a href="#multi-account-permissions-project" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="prepare-the-terraform-project"><span class="me-2">Prepare the Terraform Project</span><a href="#prepare-the-terraform-project" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="initialized-a-terraform-project-using-terraspace-framework"><span class="me-2">Initialized a Terraform Project using Terraspace Framework</span><a href="#initialized-a-terraform-project-using-terraspace-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Please create a new project where our Infrastructure is a Code definition for Terraform.</p><div class="language-bash nolineno highlighter-rouge" file="Terraspace New Project"><div class="code-header"> <span data-label-text="Terraspace New Project"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>terraspace new project aws-iam-ic-multi-account-permissions-example <span class="nt">--plugin</span> aws
<span class="nb">cd </span>aws-iam-ic-multi-account-permissions-example

<span class="c"># Makes sure we have the pregenerated files listed.</span>
tree <span class="nt">-L</span> 2
<span class="c"># .</span>
<span class="c"># ├── Gemfile</span>
<span class="c"># ├── Gemfile.lock</span>
<span class="c"># ├── README.md</span>
<span class="c"># ├── Terrafile</span>
<span class="c"># ├── app</span>
<span class="c"># │   ├── modules</span>
<span class="c"># │   └── stacks</span>
<span class="c"># └── config</span>
<span class="c">#     ├── app.rb</span>
<span class="c">#     └── terraform</span>
</pre></table></code></div></div><h3 id="prepare-the-modules"><span class="me-2">Prepare the Modules</span><a href="#prepare-the-modules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To reduce the IaC bloating and maintains the simplicity, we will be using a reusable module from <a href="https://registry.terraform.io/namespaces/cloudposse">CloudPosse</a>.</p><h4 id="install-the-sso-module"><span class="me-2">Install the SSO Module</span><a href="#install-the-sso-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="Cloud Posse Terraform Module for SSO"><div class="code-header"> <span data-label-text="Cloud Posse Terraform Module for SSO"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'mod "sso", source: "cloudposse/sso/aws", version: "0.7.1"'</span> <span class="o">&gt;&gt;</span> Terrafile
terraspace bundle
</pre></table></code></div></div><h4 id="terraspace-stack-for-the-permission-sets"><span class="me-2">Terraspace Stack for the Permission Sets</span><a href="#terraspace-stack-for-the-permission-sets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="Terraspace Stack for Permission Sets"><div class="code-header"> <span data-label-text="Terraspace Stack for Permission Sets"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>terraspace new stack permission-sets
</pre></table></code></div></div><h4 id="terraspace-stacks-for-our-aws-accounts"><span class="me-2">Terraspace Stacks for our AWS Accounts</span><a href="#terraspace-stacks-for-our-aws-accounts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="Terraspace Stacks for AWS Accounts"><div class="code-header"> <span data-label-text="Terraspace Stacks for AWS Accounts"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>terraspace new stack operations
terraspace new stack development
terraspace new stack production
</pre></table></code></div></div><h4 id="download-the-cloudposse-modules-context-file"><span class="me-2">Download the Cloudposse Modules Context File</span><a href="#download-the-cloudposse-modules-context-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="Cloudposse Context File"><div class="code-header"> <span data-label-text="Cloudposse Context File"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">ls</span> ./app/stacks/ | xargs <span class="nt">-I</span> <span class="o">{}</span> <span class="se">\</span>
curl <span class="nt">-sL</span> https://raw.githubusercontent.com/cloudposse/terraform-null-label/master/exports/context.tf <span class="se">\</span>
<span class="nt">-o</span> ./app/stacks/<span class="o">{}</span>/context.tf
</pre></table></code></div></div><h4 id="create-a-terraform-variable-files-to-identify-our-sources-on-aws-console"><span class="me-2">Create a Terraform variable files to identify our sources on AWS Console</span><a href="#create-a-terraform-variable-files-to-identify-our-sources-on-aws-console" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Cloudposse context files use these variables and form proper resource naming conventions.</p><div class="language-bash nolineno highlighter-rouge" file="tfvars/base.tfvars"><div class="code-header"> <span data-label-text="tfvars/base.tfvars"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nb">ls</span> ./app/stacks/ | xargs <span class="nt">-I</span> <span class="o">{}</span> <span class="se">\</span>
sh <span class="nt">-c</span> <span class="s1">'mkdir -p ./app/stacks/{}/tfvars &amp;&amp; tee ./app/stacks/{}/tfvars/base.tfvars &lt;&lt;EOF
enabled   = true
namespace = "aws-sso"
name      = "aws-sso"
stage     = "&lt;%= expansion('</span>:ENV<span class="s1">') %&gt;"
EOF'</span>
</pre></table></code></div></div><h4 id="create-a-permission-sets-terraform-outputs"><span class="me-2">Create a <code class="language-plaintext highlighter-rouge">permission-sets</code> Terraform outputs</span><a href="#create-a-permission-sets-terraform-outputs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>These Terraform outputs will be variables for our AWS accounts and principal assignment.</p><div class="language-bash nolineno highlighter-rouge" file="permission-sets/outputs.tf"><div class="code-header"> <span data-label-text="permission-sets/outputs.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">tee</span> ./app/stacks/permission-sets/outputs.tf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
output "permission_sets" {
  description = "Show All Permission Sets"
  value       = module.permission_sets.permission_sets
}
</span><span class="no">EOF
</span></pre></table></code></div></div><h4 id="create-a-terraform-variable-that-binding-permission-sets"><span class="me-2">Create a Terraform variable that binding <code class="language-plaintext highlighter-rouge">permission-sets</code></span><a href="#create-a-terraform-variable-that-binding-permission-sets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>AWS accounts and principal assignments require permission set via outputs.</p><div class="language-bash nolineno highlighter-rouge" file="tfvars/base.tfvars"><div class="code-header"> <span data-label-text="tfvars/base.tfvars"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">ls</span> <span class="nt">--ignore</span> <span class="s2">"permission-sets"</span> ./app/stacks/ | xargs <span class="nt">-I</span> <span class="o">{}</span> <span class="se">\</span>
sh <span class="nt">-c</span> <span class="s1">'tee -a ./app/stacks/{}/tfvars/base.tfvars &lt;&lt;EOF
permission_sets = &lt;%= output("permission-sets.permission_sets") %&gt;
EOF'</span>
</pre></table></code></div></div><h4 id="create-an-organization-terraform-outputs"><span class="me-2">Create an <code class="language-plaintext highlighter-rouge">organization</code> Terraform outputs</span><a href="#create-an-organization-terraform-outputs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Applying any Terraform action shows the output details, so we can review or validate that everything applies correctly.</p><div class="language-bash nolineno highlighter-rouge" file="operations|development|production/outputs.tf"><div class="code-header"> <span data-label-text="operations|development|production/outputs.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nb">ls</span> <span class="nt">--ignore</span> <span class="s2">"permission-sets"</span> ./app/stacks/ | xargs <span class="nt">-I</span> <span class="o">{}</span> <span class="se">\</span>
sh <span class="nt">-c</span> <span class="s1">'tee -a ./app/stacks/{}/outputs.tf &lt;&lt;EOF
output "assignments" {
  description = "Show All Account Assignments for a Permission Set"
  value       = module.sso_account_assignments.assignments
}
EOF'</span>
</pre></table></code></div></div><h4 id="create-a-an-variables-for-our-permission-sets-and-aws-accounts"><span class="me-2">Create a an variables for our Permission Sets and AWS Accounts</span><a href="#create-a-an-variables-for-our-permission-sets-and-aws-accounts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="operations|development|production/variables.tf"><div class="code-header"> <span data-label-text="operations|development|production/variables.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nb">ls</span> <span class="nt">--ignore</span> <span class="s2">"permission-sets"</span> ./app/stacks/ | xargs <span class="nt">-I</span> <span class="o">{}</span> <span class="se">\</span>
sh <span class="nt">-c</span> <span class="s1">'tee ./app/stacks/{}/variables.tf &lt;&lt;EOF
variable "permission_sets" {
}
variable "aws_account_{}" {
}
EOF'</span>
</pre></table></code></div></div><h2 id="principals-and-accounts-management"><span class="me-2">Principals and Accounts Management</span><a href="#principals-and-accounts-management" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="create-a-permission-sets-resource"><span class="me-2">Create a Permission Sets Resource</span><a href="#create-a-permission-sets-resource" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="first-create-an-example-of-an-inline-policy-for-one-of-our-permission-sets"><span class="me-2">First, create an example of an inline policy for one of our Permission Sets</span><a href="#first-create-an-example-of-an-inline-policy-for-one-of-our-permission-sets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="permission-sets/inline_policy_S3Access.tf"><div class="code-header"> <span data-label-text="permission-sets/inline_policy_S3Access.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nb">tee</span> ./app/stacks/permission-sets/inline_policy_S3Access.tf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
data "aws_iam_policy_document" "inline_policy_S3Acccess" {
  statement {
    sid = "1"

    actions = ["*"]

    resources = [
      "arn:aws:s3:::*",
    ]
  }
}
</span><span class="no">EOF
</span></pre></table></code></div></div><h4 id="permission-sets-resource-definitions"><span class="me-2">Permission Sets Resource Definitions</span><a href="#permission-sets-resource-definitions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="permission-sets/main.tf"><div class="code-header"> <span data-label-text="permission-sets/main.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="nb">tee</span> ./app/stacks/permission-sets/main.tf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
module "permission_sets" {
  source  = "../../modules/sso/modules/permission-sets"
  context = module.this.context

  permission_sets = [

    {
      name             = "AdministratorAccess",
      description      = "Provides full access to AWS services and resources.",
      relay_state      = "",
      session_duration = "PT12H",
      tags             = {},
      inline_policy    = "",
      policy_attachments = [
        "arn:aws:iam::aws:policy/AdministratorAccess",
      ]
      customer_managed_policy_attachments = []
    },

    {
      name             = "PowerUserAccess",
      description      = "Provides full access to AWS services and resources, but does not allow management of Users and groups.",
      relay_state      = "",
      session_duration = "PT12H",
      tags             = {},
      inline_policy    = "",
      policy_attachments = [
        "arn:aws:iam::aws:policy/PowerUserAccess",
      ]
      customer_managed_policy_attachments = []
    },

    {
      name             = "ReadOnlyAccess"
      description      = "Provides read-only access to AWS services and resources."
      relay_state      = ""
      session_duration = "PT12H"
      tags             = {}
      inline_policy    = data.aws_iam_policy_document.inline_policy_S3Acccess.json
      policy_attachments = [
        "arn:aws:iam::aws:policy/ReadOnlyAccess",
      ]
      customer_managed_policy_attachments = []
    },

  ]
}
</span><span class="no">EOF
</span></pre></table></code></div></div><p>At this point, we completed the Permission Sets stack creation and can initially apply it if we want.</p><div class="language-bash nolineno highlighter-rouge" file="Terraspace Command"><div class="code-header"> <span data-label-text="Terraspace Command"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>terraspace plan permission-sets
terraspace up permission-sets
</pre></table></code></div></div><h3 id="create-an-accounts-assignments-resources"><span class="me-2">Create an Accounts Assignments Resources</span><a href="#create-an-accounts-assignments-resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="operations-account-resource-definitions"><span class="me-2">Operations Account Resource Definitions</span><a href="#operations-account-resource-definitions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="operations/main.tf"><div class="code-header"> <span data-label-text="operations/main.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nb">tee</span> ./app/stacks/operations/main.tf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
module "sso_account_assignments" {
  source  = "../../modules/sso/modules/account-assignments"
  context = module.this.context

  account_assignments = [

    ############
    ## GROUPS ##
    ############
    {
      principal_name      = "administrator"
      principal_type      = "GROUP"
      permission_set_name = "AdministratorAccess"
      permission_set_arn  = var.permission_sets["AdministratorAccess"].arn
      account             = var.aws_account_operations
    },

    ###########
    ## USERS ##
    ###########
    {
      principal_name      = "sarahjane@domain.tld"
      principal_type      = "USER"
      permission_set_name = "AdministratorAccess"
      permission_set_arn  = var.permission_sets["AdministratorAccess"].arn
      account             = var.aws_account_operations
    },

  ]
}
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Plan and apply for Operations Account.</p><div class="language-bash nolineno highlighter-rouge" file="Terraspace Command"><div class="code-header"> <span data-label-text="Terraspace Command"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>terraspace plan operations
terraspace up operations
</pre></table></code></div></div><h4 id="development-account-resource-definitions"><span class="me-2">Development Account Resource Definitions</span><a href="#development-account-resource-definitions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="development/main.tf"><div class="code-header"> <span data-label-text="development/main.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="nb">tee</span> ./app/stacks/development/main.tf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
module "sso_account_assignments" {
  source  = "../../modules/sso/modules/account-assignments"
  context = module.this.context

  account_assignments = [

    ############
    ## GROUPS ##
    ############
    {
      principal_name      = "administrator"
      principal_type      = "GROUP"
      permission_set_name = "AdministratorAccess"
      permission_set_arn  = var.permission_sets["AdministratorAccess"].arn
      account             = var.aws_account_development
    },

    {
      principal_name      = "developer"
      principal_type      = "GROUP"
      permission_set_name = "PowerUserAccess"
      permission_set_arn  = var.permission_sets["PowerUserAccess"].arn
      account             = var.aws_account_development
    },

    ###########
    ## USERS ##
    ###########
    {
      principal_name      = "sarahjane@domain.tld"
      principal_type      = "USER"
      permission_set_name = "PowerUserAccess"
      permission_set_arn  = var.permission_sets["PowerUserAccess"].arn
      account             = var.aws_account_development
    },
    {
      principal_name      = "antoniamorris@domain.tld"
      principal_type      = "USER"
      permission_set_name = "ReadOnlyAccess"
      permission_set_arn  = var.permission_sets["ReadOnlyAccess"].arn
      account             = var.aws_account_development
    },

  ]
}
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Plan and apply for Development Account.</p><div class="language-bash nolineno highlighter-rouge" file="Terraspace Command"><div class="code-header"> <span data-label-text="Terraspace Command"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>terraspace plan development
terraspace up development
</pre></table></code></div></div><h4 id="production-account-resource-definition"><span class="me-2">Production Account Resource Definition</span><a href="#production-account-resource-definition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="production/main.tf"><div class="code-header"> <span data-label-text="production/main.tf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="nb">tee</span> ./app/stacks/production/main.tf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
module "sso_account_assignments" {
  source  = "../../modules/sso/modules/account-assignments"
  context = module.this.context

  account_assignments = [

    ############
    ## GROUPS ##
    ############
    {
      principal_name      = "administrator"
      principal_type      = "GROUP"
      permission_set_name = "AdministratorAccess"
      permission_set_arn  = var.permission_sets["AdministratorAccess"].arn
      account             = var.aws_account_production
    },

    {
      principal_name      = "developer"
      principal_type      = "GROUP"
      permission_set_name = "ReadOnlyAccess"
      permission_set_arn  = var.permission_sets["ReadOnlyAccess"].arn
      account             = var.aws_account_production
    },

    ###########
    ## USERS ##
    ###########
    {
      principal_name      = "sarahjane@domain.tld"
      principal_type      = "USER"
      permission_set_name = "AdministratorAccess"
      permission_set_arn  = var.permission_sets["AdministratorAccess"].arn
      account             = var.aws_account_production
    },

  ]
}
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Plan and apply for Production Account.</p><div class="language-bash nolineno highlighter-rouge" file="Terraspace Command"><div class="code-header"> <span data-label-text="Terraspace Command"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>terraspace plan production
terraspace up production
</pre></table></code></div></div><h3 id="stacks-final-directory-structure"><span class="me-2">Stacks Final Directory Structure</span><a href="#stacks-final-directory-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash nolineno highlighter-rouge" file="App Stacks"><div class="code-header"> <span data-label-text="App Stacks"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>tree <span class="nt">-L</span> 3 ./app/stacks
<span class="c"># ./app/stacks</span>
<span class="c"># ├── development</span>
<span class="c"># │   ├── context.tf</span>
<span class="c"># │   ├── main.tf</span>
<span class="c"># │   ├── outputs.tf</span>
<span class="c"># │   ├── tfvars</span>
<span class="c"># │   │   └── base.tfvars</span>
<span class="c"># │   └── variables.tf</span>
<span class="c"># ├── operations</span>
<span class="c"># │   ├── context.tf</span>
<span class="c"># │   ├── main.tf</span>
<span class="c"># │   ├── outputs.tf</span>
<span class="c"># │   ├── tfvars</span>
<span class="c"># │   │   └── base.tfvars</span>
<span class="c"># │   └── variables.tf</span>
<span class="c"># ├── permission-sets</span>
<span class="c"># │   ├── context.tf</span>
<span class="c"># │   ├── inline_policy_S3Access.tf</span>
<span class="c"># │   ├── main.tf</span>
<span class="c"># │   ├── outputs.tf</span>
<span class="c"># │   ├── tfvars</span>
<span class="c"># │   │   └── base.tfvars</span>
<span class="c"># │   └── variables.tf</span>
<span class="c"># └── production</span>
<span class="c">#     ├── context.tf</span>
<span class="c">#     ├── main.tf</span>
<span class="c">#     ├── outputs.tf</span>
<span class="c">#     ├── tfvars</span>
<span class="c">#     │   └── base.tfvars</span>
<span class="c">#     └── variables.tf</span>
</pre></table></code></div></div><h4 id="plan-and-apply-all-stacks"><span class="me-2">Plan and Apply All Stacks</span><a href="#plan-and-apply-all-stacks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We can also plan and apply at once the entire stacks, as you have seen in the <a href="#quick-demo">Multi-Account Terraform Quick Action Demo</a>.</p><div class="language-bash nolineno highlighter-rouge" file="Terraspace Command"><div class="code-header"> <span data-label-text="Terraspace Command"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>terraspace all plan
terraspace all up
</pre></table></code></div></div><h3 id="access-portal-example-scenarios"><span class="me-2">Access Portal Example Scenarios</span><a href="#access-portal-example-scenarios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Based on our Terraform resource accounts assignments.</p><h4 id="user-john-doe-under-the-administrator-group"><span class="me-2">User <code class="language-plaintext highlighter-rouge">John Doe</code> under the <code class="language-plaintext highlighter-rouge">administrator</code> group.</span><a href="#user-john-doe-under-the-administrator-group" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote class="prompt-info"><p>The <code class="language-plaintext highlighter-rouge">administrator</code> group is assigned to all accounts</p></blockquote><p><a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-johndoe-dark.png" class="popup img-link dark shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-johndoe-dark.png" alt="AWS Console Access Portal" loading="lazy"></a> <a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-johndoe-light.png" class="popup img-link light shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-johndoe-light.png" alt="AWS Console Access Portal" loading="lazy"></a></p><h4 id="user-sarah-jane-under-the-operations-group"><span class="me-2">User <code class="language-plaintext highlighter-rouge">Sarah Jane</code> under the <code class="language-plaintext highlighter-rouge">operations</code> group.</span><a href="#user-sarah-jane-under-the-operations-group" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote class="prompt-info"><p>The <code class="language-plaintext highlighter-rouge">operations</code> group is not assigned, however we specifically assigned the user.</p></blockquote><p><a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-sarahjane-dark.png" class="popup img-link dark shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-sarahjane-dark.png" alt="AWS Console Access Portal" loading="lazy"></a> <a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-sarahjane-light.png" class="popup img-link light shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-sarahjane-light.png" alt="AWS Console Access Portal" loading="lazy"></a></p><h4 id="user-marcello-kelley-and-miliana-smith-under-the-developer-group"><span class="me-2">User <code class="language-plaintext highlighter-rouge">Marcello Kelley</code> and <code class="language-plaintext highlighter-rouge">Miliana Smith</code> under the <code class="language-plaintext highlighter-rouge">developer</code> group.</span><a href="#user-marcello-kelley-and-miliana-smith-under-the-developer-group" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote class="prompt-info"><p>The <code class="language-plaintext highlighter-rouge">developer</code> group members are assigned to specific accounts with different access levels.</p></blockquote><p><a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-marcellokelley-dark.png" class="popup img-link dark shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-marcellokelley-dark.png" alt="AWS Console Access Portal" loading="lazy"></a> <a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-marcellokelley-light.png" class="popup img-link light shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-marcellokelley-light.png" alt="AWS Console Access Portal" loading="lazy"></a></p><p><a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-milianasmith-dark.png" class="popup img-link dark shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-milianasmith-dark.png" alt="AWS Console Access Portal" loading="lazy"></a> <a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-milianasmith-light.png" class="popup img-link light shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-milianasmith-light.png" alt="AWS Console Access Portal" loading="lazy"></a></p><h4 id="user-antonia-morris-is-under-no-group"><span class="me-2">User <code class="language-plaintext highlighter-rouge">Antonia Morris</code> is under no group.</span><a href="#user-antonia-morris-is-under-no-group" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote class="prompt-info"><p>The user is assigned to specific account with its own access level.</p></blockquote><p><a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-antoniamorris-dark.png" class="popup img-link dark shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-antoniamorris-dark.png" alt="AWS Console Access Portal" loading="lazy"></a> <a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-antoniamorris-light.png" class="popup img-link light shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/aws-iam-ic-console-access-portal-antoniamorris-light.png" alt="AWS Console Access Portal" loading="lazy"></a></p><h2 id="automate-using-github-actions"><span class="me-2">Automate using Github Actions</span><a href="#automate-using-github-actions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="github-actions-workflow"><span class="me-2">GitHub Actions Workflow</span><a href="#github-actions-workflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="create-a-github-actions-workflow-file"><span class="me-2">Create a GitHub Actions Workflow File</span><a href="#create-a-github-actions-workflow-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash nolineno highlighter-rouge" file="Github Actions Workflow File"><div class="code-header"> <span data-label-text="Github Actions Workflow File"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> ./.github/workflows <span class="o">&amp;&amp;</span> <span class="nb">tee</span> ./.github/workflows/apply-assignments.yml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
name: "Apply Assignments for Accounts and Permission Sets"
on:
  push:
    branches:
      - main
env:
  AWS_REGION: "us-east-1"
  AWS_ACCESS_KEY_ID: </span><span class="se">\$</span><span class="sh">{{ secrets.PROVISIONER_AWS_ACCESS_KEY_ID }}
  AWS_SECRET_ACCESS_KEY: </span><span class="se">\$</span><span class="sh">{{ secrets.PROVISIONER_AWS_SECRET_ACCESS_KEY }}
  AWS_ACCOUNT_ID: </span><span class="se">\$</span><span class="sh">{{ secrets.OPERATIONS_AWS_ACCOUNT_ID }}

  TS_ENV: "dev"
  TF_VAR_aws_account_operations: </span><span class="se">\$</span><span class="sh">{{ secrets.OPERATIONS_AWS_ACCOUNT_ID }}
  TF_VAR_aws_account_development: </span><span class="se">\$</span><span class="sh">{{ secrets.DEVELOPMENT_AWS_ACCOUNT_ID }}
  TF_VAR_aws_account_production: </span><span class="se">\$</span><span class="sh">{{ secrets.PRODUCTION_AWS_ACCOUNT_ID }}

jobs:
  apply-assignments:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          submodules: true

      - name: Install Terraform
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_wrapper: false
          terraform_version: 1.3.9

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1.2'

      - name: Install Terraspace
        run: |
          bundle install

      - name: Download Terraform Modules
        run: |
          terraspace bundle

      - name: Terraspace All Init
        run: |
          terraspace all init -y

      - name: Terraspace All Up
        run: |
          terraspace all up -y

      - name: Upload Logs to Artifacts
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: terraspace-logs
          path: ./log/*
</span><span class="no">EOF
</span></pre></table></code></div></div><h4 id="create-a-secrets-in-our-github-repository"><span class="me-2">Create a Secrets in our GitHub Repository</span><a href="#create-a-secrets-in-our-github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-text nolineno highlighter-rouge" file="Github Secrets"><div class="code-header"> <span data-label-text="Github Secrets"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>PROVISIONER_AWS_ACCESS_KEY_ID
PROVISIONER_AWS_SECRET_ACCESS_KEY
OPERATIONS_AWS_ACCOUNT_ID
DEVELOPMENT_AWS_ACCOUNT_ID
PRODUCTION_AWS_ACCOUNT_ID
</pre></table></code></div></div><h4 id="github-actions-workflow-page"><span class="me-2">GitHub Actions Workflow Page</span><a href="#github-actions-workflow-page" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/github-actions-workflow-page-dark.png" class="popup img-link shimmer"><img src="/assets/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/github-actions-workflow-page-dark.png" alt="GitHub Actions Worflow Page" loading="lazy"></a></p><p>At this point, we can also automate the process using GitHub Actions. Without the locally installed Operations Tools, we maximized the cloud resource.</p><h4 id="final-github-project-repository"><span class="me-2">Final GitHub Project Repository</span><a href="#final-github-project-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>You can download the final and working example project repository at this link <a href="https://github.com/nathanielvarona/aws-iam-ic-multi-account-permissions-example" target="_blank">https://github.com/nathanielvarona/aws-iam-ic-multi-account-permissions-example</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aws/">AWS</a>, <a href="/categories/iam-identity-center/">IAM Identity Center</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/amazon-web-services-aws/" class="post-tag no-text-decoration" >Amazon Web Services (AWS)</a> <a href="/tags/single-sign-on-sso/" class="post-tag no-text-decoration" >Single Sign-On (SSO)</a> <a href="/tags/aws-iam-identity-center/" class="post-tag no-text-decoration" >AWS IAM Identity Center</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Managing%20AWS%20IAM%20Identity%20Center%20Multi-Account%20Permissions%20using%20Terraform%20and%20GitHub%20Actions%20-%20Nathaniel%20Varona&url=https%3A%2F%2Fnathaniel.varona.me%2Fposts%2Fmanaging-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Managing%20AWS%20IAM%20Identity%20Center%20Multi-Account%20Permissions%20using%20Terraform%20and%20GitHub%20Actions%20-%20Nathaniel%20Varona&u=https%3A%2F%2Fnathaniel.varona.me%2Fposts%2Fmanaging-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/feed/?shareActive=true&shareUrl=https%3A%2F%2Fnathaniel.varona.me%2Fposts%2Fmanaging-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/google-workspace-as-external-idp-for-aws-iam-identity-center/">Google Workspace as an external IdP for AWS IAM Identity Center</a><li class="text-truncate lh-lg"> <a href="/posts/automatic-provisioning-of-aws-iam-identity-center-users-and-groups-from-google-workspace-directory-using-sso-sync/">Automatic Provisioning of AWS IAM Identity Center Users and Groups from Google Workspace Directory using SSO Sync</a><li class="text-truncate lh-lg"> <a href="/posts/managing-aws-iam-identity-center-multi-account-permissions-using-terraform-and-github-actions/">Managing AWS IAM Identity Center Multi-Account Permissions using Terraform and GitHub Actions</a><li class="text-truncate lh-lg"> <a href="/posts/managing-enterprise-vpn-using-pritunl-api-cli/">Managing Enterprise VPN using Pritunl API CLI</a><li class="text-truncate lh-lg"> <a href="/posts/build-a-pritunl-slack-slash-commands-with-a-serverless-backend/">Build a Pritunl Slack Slash Commands with a Serverless Backend</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-web-services-aws/">Amazon Web Services (AWS)</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws-iam-identity-center/">AWS IAM Identity Center</a> <a class="post-tag btn btn-outline-primary" href="/tags/single-sign-on-sso/">Single Sign-On (SSO)</a> <a class="post-tag btn btn-outline-primary" href="/tags/api-client/">API Client</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws-sam/">AWS SAM</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-cloud-platform-gcp/">Google Cloud Platform (GCP)</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-workspace-gsuite/">Google Workspace (GSuite)</a> <a class="post-tag btn btn-outline-primary" href="/tags/openvpn/">OpenVPN</a> <a class="post-tag btn btn-outline-primary" href="/tags/pritunl-vpn/">Pritunl VPN</a> <a class="post-tag btn btn-outline-primary" href="/tags/python-library/">Python Library</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/automatic-provisioning-of-aws-iam-identity-center-users-and-groups-from-google-workspace-directory-using-sso-sync/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1676044800" data-df="ll" > Feb 11, 2023 </time><h4 class="pt-0 my-2">Automatic Provisioning of AWS IAM Identity Center Users and Groups from Google Workspace Directory using SSO Sync</h4><div class="text-muted"><p>Introduction AWS IAM Identity Center supports automatic provisioning from various providers, including OneLogin, Microsoft Azure Active Directory, on-premise MS Active Directory, and other support...</p></div></div></a></article><article class="col"> <a href="/posts/google-workspace-as-external-idp-for-aws-iam-identity-center/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1674748800" data-df="ll" > Jan 27, 2023 </time><h4 class="pt-0 my-2">Google Workspace as an external IdP for AWS IAM Identity Center</h4><div class="text-muted"><p>Introduction Google Workspace (formerly known as GSuite) is a typical first service for companies embracing the cloud, especially startups. Google Workspace provides out-of-the-box services like e...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/automatic-provisioning-of-aws-iam-identity-center-users-and-groups-from-google-workspace-directory-using-sso-sync/" class="btn btn-outline-primary" aria-label="Older" ><p>Automatic Provisioning of AWS IAM Identity Center Users and Groups from Google Workspace Directory using SSO Sync</p></a> <a href="/posts/managing-enterprise-vpn-using-pritunl-api-cli/" class="btn btn-outline-primary" aria-label="Newer" ><p>Managing Enterprise VPN using Pritunl API CLI</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/nathanielvarona">Nathaniel Varona</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-web-services-aws/">Amazon Web Services (AWS)</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws-iam-identity-center/">AWS IAM Identity Center</a> <a class="post-tag btn btn-outline-primary" href="/tags/single-sign-on-sso/">Single Sign-On (SSO)</a> <a class="post-tag btn btn-outline-primary" href="/tags/api-client/">API Client</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws-sam/">AWS SAM</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-cloud-platform-gcp/">Google Cloud Platform (GCP)</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-workspace-gsuite/">Google Workspace (GSuite)</a> <a class="post-tag btn btn-outline-primary" href="/tags/openvpn/">OpenVPN</a> <a class="post-tag btn btn-outline-primary" href="/tags/pritunl-vpn/">Pritunl VPN</a> <a class="post-tag btn btn-outline-primary" href="/tags/python-library/">Python Library</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'nathanielvarona/nathanielvarona.github.io', 'data-repo-id': 'R_kgDOI9wegw', 'data-category': 'Comments', 'data-category-id': 'DIC_kwDOI9weg84CUvHZ', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
